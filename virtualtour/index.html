<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width, shrink-to-fit=no">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <title>Panolens.js panorama video</title>
    <style>
      html, body {
        width: 100%;
        height: 100%;
        overflow: hidden;
        margin: 0;
      }

      #container {
        width: 100%;
        height: 100%;
      }
    </style>
  </head>

  <body>
  <div id="container"></div>
    <script src="https://dansyakuro.github.io/virtualtour/three/three.min.js"></script>
    <script src="https://dansyakuro.github.io/virtualtour/panolens/panolens.min.js"></script>

    <script>
      $(document).ready( async function(){
        var viewer, container, a, xyz;
        let [panorama, infospot] = [[],[]];
        let [x,y,z] = [[],[],[]];

        container = document.querySelector( '#container' );
        viewer = new PANOLENS.Viewer( { container: container } );
        await fetch('https://dansyakuro.github.io/virtualtour/data.json')
        .then(res =>res.json())
        .then(json => {  
          json.forEach((valueDPI, indexDPI) => {
            panorama[indexDPI] = new PANOLENS.ImagePanorama( valueDPI.image_name ); //variable dari iterasi array dPI
            panorama[indexDPI].addEventListener( 'enter-fade-start', function(){
              [x,y,z] = valueDPI.data[0].location;
              viewer.tweenControlCenter(  new THREE.Vector3( x,y,z ), 0);
            });
            panorama[indexDPI].addEventListener("click", function(e){
                if (e.intersects.length > 0) return;
                a = viewer.raycaster.intersectObject(viewer.panorama, true)[0].point;
                xyz = a.x+","+a.y+","+a.z;
                console.log('(x,y,z) = ' + xyz);
              });
            valueDPI.data.forEach((valueData, indexData) => {
              infospot[indexData] = new PANOLENS.Infospot( 300, PANOLENS.DataImage.Arrow );
              [x,y,z] = valueDPI.data[indexData].location; //variable dari iterasi array dPI dan var iterasi count target
              infospot[indexData].position.set( x, y, z );
              infospot[indexData].addHoverText( "Halaman "+valueDPI.data[indexData].page);
              infospot[indexData].addEventListener( 'click', function(){
                viewer.setPanorama( panorama[valueDPI.data[indexData].index] );
                console.log(valueDPI.data[indexData].index);
              } );
              panorama[indexDPI].add( infospot[indexData] );
            });

            viewer.add( panorama[indexDPI] );
          })
        });
      });
    </script>
  </body>
</html>
